ymaps.ready(init);

function init() {
  const map = new ymaps.Map(
    "map",
    {
      center: [43.118136, 131.92137],
      zoom: 18.5,
      controls: [],
      yandexMapType: "future_map",
    },
    // type: null,
    {
      restrictMapArea: [
        [43.115, 131.92],
        [43.119, 131.926],
      ],
    }
  );

  const first_zone = [
    [43.118432, 131.920995],
    [43.118426, 131.920987],
    [43.118413, 131.920983],
    [43.118385, 131.920865],
    [43.118394, 131.92084],
    [43.118397, 131.920819],
    [43.118358, 131.920654],
    [43.118347, 131.920638],
    [43.118339, 131.920634],
    [43.118284, 131.920636],
    [43.118282, 131.92061],
    [43.118189, 131.920609],
    [43.11814, 131.920731],
    [43.118162, 131.920754],
    [43.118162, 131.920754],
    [43.118185, 131.920799],
    [43.118192, 131.920835],
    [43.118192, 131.920835],
    [43.118177, 131.9209],
    [43.118149, 131.920937],
    [43.118132, 131.920943],
    [43.118093, 131.920937],
    [43.118004, 131.92106],
    [43.117878, 131.921258],
    [43.117757, 131.921525],
    [43.117641, 131.921858],
    [43.117587, 131.922009],
    [43.117574, 131.922062],
    [43.117565, 131.922131],
    [43.117565, 131.922131],
    [43.117551, 131.922482],
    [43.117709, 131.923608],
    [43.117852, 131.92344],
    [43.11786, 131.923438],
    [43.117891, 131.923489],
    [43.118702, 131.923397],
    [43.118715, 131.923358],
    [43.118708, 131.923318],
    [43.118693, 131.923291],
    [43.118667, 131.922952],
    [43.11867, 131.922955],
    [43.118673, 131.922952],
    [43.118677, 131.922824],
    [43.118669, 131.922706],
    [43.118666, 131.922704],
    [43.118663, 131.92263],
    [43.118666, 131.922627],
    [43.118645, 131.922205],
    [43.118642, 131.922203],
    [43.118615, 131.922206],
    [43.118615, 131.922185],
    [43.118581, 131.921658],
    [43.118594, 131.921655],
    [43.118604, 131.921653],
    [43.118604, 131.921653],
    [43.118621, 131.921567],
    [43.118591, 131.921506],
    [43.118552, 131.921411],
    [43.118486, 131.921254],
    [43.118432, 131.920995],
  ];

  const second_zone = [
    [43.117883894251825, 131.92350487512735],
    [43.117817086572515, 131.92351561102186],
    [43.11775420875669, 131.92353171486363],
    [43.117714910121805, 131.9236014981779],
    [43.117652032305976, 131.92362833791415],
    [43.117589154490155, 131.92364980970316],
    [43.11752627667433, 131.9236659135449],
    [43.11747125858549, 131.92360686612514],
    [43.117455539131534, 131.92352097896912],
    [43.11743588981409, 131.92343509181308],
    [43.11740445090618, 131.92335994055153],
    [43.11736908213478, 131.92328478929002],
    [43.11732192377291, 131.92322574187025],
    [43.11725904595709, 131.92320963802848],
    [43.11719223827778, 131.92320963802848],
    [43.11712543059847, 131.9232311098175],
    [43.11706255278265, 131.92325794955374],
    [43.11699967496683, 131.92327942134276],
    [43.116936797151006, 131.92329552518453],
    [43.116873919335184, 131.92323647776476],
    [43.11682283110983, 131.92317743034496],
    [43.11675602343052, 131.92317206239773],
    [43.1166931456147, 131.92317743034496],
    [43.116630267798875, 131.92318816623947],
    [43.11657917957352, 131.923241845712],
    [43.11652416148467, 131.92329015723726],
    [43.11648093298629, 131.9233545726043],
    [43.11645735380536, 131.92344045976034],
    [43.11648093298629, 131.92352634691636],
    [43.11653202121165, 131.9235800263889],
    [43.116563460119565, 131.9236551776504],
    [43.116594899027476, 131.92374106480645],
    [43.11661847820841, 131.9238269519625],
    [43.11664598725283, 131.92390747117128],
    [43.11667742616074, 131.92398799038006],
    [43.11670886506865, 131.92406314164157],
    [43.116763883157496, 131.9241168211141],
    [43.11681890124634, 131.92416513263936],
    [43.116866059608206, 131.92422418005916],
    [43.116905358243095, 131.92429396337343],
    [43.116940727014494, 131.92436911463494],
    [43.116972165922405, 131.92444426589648],
    [43.117007534693805, 131.92451941715802],
    [43.117038973601716, 131.92459456841954],
    [43.11707041250963, 131.92466971968108],
    [43.117113641008004, 131.9247341350481],
    [43.117176518823825, 131.92475023888986],
    [43.117243326503136, 131.92475023888986],
    [43.11730227445547, 131.92471803120634],
    [43.11736515227129, 131.9246911914701],
    [43.11742803008711, 131.92466971968108],
    [43.11749090790293, 131.9246643517338],
    [43.117553785718755, 131.92464824789207],
    [43.11761666353458, 131.9246106722613],
    [43.11766775175994, 131.92455699278878],
    [43.117710980258316, 131.92449257742174],
    [43.11775420875669, 131.92442816205474],
    [43.11777778793763, 131.92430469926794],
    [43.11779350739158, 131.92421344416465],
    [43.11780529698205, 131.9241275570086],
    [43.117813156709026, 131.92403630190532],
    [43.117821016436004, 131.92395041474927],
    [43.11782887616298, 131.92386452759325],
    [43.11783673588996, 131.9237786404372],
    [43.117848525480426, 131.9236927532812],
    [43.1178563852074, 131.92360686612514],
    [43.11786817479787, 131.92351561102186],
  ];

  const third_zone = [
    [43.116873452016385, 131.92321885797813],
    [43.1168813118634, 131.92313297082208],
    [43.116877381939894, 131.92304708366603],
    [43.116834152781294, 131.92298266829903],
    [43.11677520392866, 131.92293435677377],
    [43.116747694464095, 131.9228377337232],
    [43.11673197477006, 131.92274647861993],
    [43.116724114923045, 131.92265522351664],
    [43.11669660545848, 131.92257470430786],
    [43.11663372668234, 131.9225586004661],
    [43.11657870775321, 131.92260691199138],
    [43.11651582897707, 131.92263375172763],
    [43.11645295020093, 131.9226015440441],
    [43.11641365096584, 131.92252639278257],
    [43.11637042180724, 131.9224566094683],
    [43.11630361310759, 131.92246197741557],
    [43.116248594178465, 131.92251028894083],
    [43.116189645325825, 131.92255323251885],
    [43.11613069647319, 131.9225908081496],
    [43.11606388777354, 131.92261227993862],
    [43.1160010089974, 131.92263911967487],
    [43.11593813022125, 131.92266595941115],
    [43.11587525144511, 131.9226927991474],
    [43.11581237266897, 131.92272500683092],
    [43.115757353739845, 131.92277868630345],
    [43.11571019465774, 131.9228377337232],
    [43.11568661511668, 131.922918252932],
    [43.11568268519317, 131.92300414008804],
    [43.11570233481072, 131.92309539519132],
    [43.115714124581245, 131.92318128234734],
    [43.11573377419879, 131.9232671695034],
    [43.11576914351037, 131.92334232076493],
    [43.11581630259248, 131.9234013681847],
    [43.11585953175108, 131.9234657835517],
    [43.11589883098617, 131.923535566866],
    [43.11593813022125, 131.92360535018028],
    [43.11598135937985, 131.92367513349456],
    [43.116040308232485, 131.92371807707258],
    [43.116099257085125, 131.9237502847561],
    [43.116162135861266, 131.9237717565451],
    [43.11622501463741, 131.9237932283341],
    [43.11629182333706, 131.9238147001231],
    [43.116354702113206, 131.92383617191211],
    [43.116425440736364, 131.9238737475429],
    [43.116484389589, 131.9239166911209],
    [43.11653940851812, 131.92396500264618],
    [43.11659442744725, 131.92401331417145],
    [43.11664944637637, 131.92405625774947],
    [43.11665337629988, 131.92397037059342],
    [43.116637656605846, 131.92387911549014],
    [43.11662193691181, 131.9237932283341],
    [43.11659442744725, 131.92370734117807],
    [43.11655905813567, 131.9236268219693],
    [43.11651189905356, 131.9235463027605],
    [43.11648045966549, 131.9234657835517],
    [43.11648045966549, 131.92337452844842],
    [43.11651975890058, 131.92330474513415],
    [43.116574777829705, 131.92325643360888],
    [43.116637656605846, 131.92321349003086],
    [43.11670053538199, 131.92319738618912],
    [43.116763414158136, 131.92319201824185],
    [43.116830222857786, 131.92319201824185],
  ];

  const parkPolygon1 = new ymaps.Polygon(
    [first_zone],
    {},
    {
      fillColor: "rgba(205, 236, 178, 1)",
      strokeColor: "#008000",
      strokeWidth: 2,
    }
  );
  map.geoObjects.add(parkPolygon1);

  const parkPolygon2 = new ymaps.Polygon(
    [second_zone],
    {},
    {
      fillColor: "rgba(205, 236, 178, 1)",
      strokeColor: "#008000",
      strokeWidth: 2,
    }
  );
  map.geoObjects.add(parkPolygon2);

  const parkPolygon3 = new ymaps.Polygon(
    [third_zone],
    {},
    {
      fillColor: "rgba(205, 236, 178, 1)",
      strokeColor: "#008000",
      strokeWidth: 2,
    }
  );
  map.geoObjects.add(parkPolygon3);

  const paths = [
    // line1
    [
      [43.11839, 131.921477],
      [43.11839, 131.921425],
      [43.118391, 131.921403],
      [43.118389, 131.921376],
      [43.118373, 131.921333],
    ],

    // line2
    [
      [43.118373, 131.921333],
      [43.118356, 131.921336],
      [43.118338, 131.921328],
      [43.118284, 131.921268],
    ],

    // line3
    [
      [43.118284, 131.921268],
      [43.11828, 131.921315],
      [43.118273, 131.921351],
      [43.118266, 131.921391],
      [43.118252, 131.921412],
      [43.118238, 131.921422],
      [43.11822, 131.921422],
      [43.118202, 131.921412],
      [43.11818, 131.921366],
      [43.118186, 131.921342],
      [43.118196, 131.921324],
      [43.118217, 131.921307],
      [43.118236, 131.921308],
      [43.118253, 131.92132],
      [43.118273, 131.921351],
    ],

    // line4
    [
      [43.11818, 131.921366],
      [43.11817, 131.921351],
      [43.118125, 131.921312],
      [43.118112, 131.92129],
      [43.118104, 131.921263],
      [43.118101, 131.921226],
      [43.118102, 131.921193],
      [43.118115, 131.92112],
      [43.118172, 131.92103],
      [43.118196, 131.92098],
      [43.118215, 131.920963],
      [43.118231, 131.920962],
      [43.118245, 131.920965],
      [43.118258, 131.920977],
      [43.118271, 131.921006],
      [43.1183, 131.921116],
      [43.118305, 131.92116],
      [43.118301, 131.921184],
      [43.118287, 131.921231],
      [43.118284, 131.921248],
      [43.118284, 131.921268],
    ],

    // line5
    [
      [43.118373, 131.921333],
      [43.118384, 131.921308],
      [43.118388, 131.921237],
      [43.118384, 131.921161],
      [43.118376, 131.92112],
      [43.118335, 131.920996],
      [43.118314, 131.920949],
      [43.118283, 131.920908],
      [43.118265, 131.920891],
      [43.118238, 131.920878],
      [43.118203, 131.920885],
      [43.118158, 131.920982],
      [43.118135, 131.921014],
      [43.118107, 131.921038],
      [43.118053, 131.921061],
      [43.118032, 131.921087],
      [43.118027, 131.921123],
      [43.118027, 131.921164],
      [43.118064, 131.921315],
      [43.11806, 131.921411],
      [43.118062, 131.921476],
      [43.118177, 131.921496],
      [43.118241, 131.921498],
      [43.118322, 131.92149],
      [43.11839, 131.921477],
    ],

    // line6
    [
      [43.118283, 131.920908],
      [43.118273, 131.920828],
      [43.118258, 131.92078],
      [43.118242, 131.920768],
      [43.118226, 131.920772],
      [43.118215, 131.920786],
      [43.118205, 131.920807],
      [43.118203, 131.920885],
    ],

    // line7
    [
      [43.118238, 131.920878],
      [43.118223, 131.920803],
      [43.118215, 131.920786],
      [43.118203, 131.920759],
      [43.118193, 131.920734],
      [43.11819, 131.920718],
      [43.118191, 131.920694],
      [43.118209, 131.920658],
      [43.118225, 131.920643],
      [43.118286, 131.920628],
    ],

    // line8
    [
      [43.118203, 131.920759],
      [43.118176, 131.920796],
    ],

    // line9
    [
      [43.11839, 131.921425],
      [43.118425, 131.921429],
      [43.118454, 131.921425],
      [43.118471, 131.921415],
      [43.118483, 131.921396],
      [43.118491, 131.921371],
      [43.118507, 131.921345],
      [43.11852, 131.92133],
    ],

    // line10
    [
      [43.118062, 131.921476],
      [43.117876, 131.921442],
      [43.11785, 131.921434],
      [43.117819, 131.921388],
    ],

    // line11
    [
      [43.11839, 131.921477],
      [43.118477, 131.921463],
      [43.118516, 131.921451],
      [43.118538, 131.921436],
      [43.118555, 131.921414],
    ],

    // line12
    [
      [43.118594, 131.92151],
      [43.118513, 131.921549],
      [43.118398, 131.921588],
      [43.118348, 131.921593],
      [43.118203, 131.921588],
      [43.118183, 131.921592],
      [43.118138, 131.921633],
      [43.118071, 131.921679],
      [43.117977, 131.921691],
      [43.117893, 131.921875],
      [43.117856, 131.921952],
      [43.11784, 131.922015],
      [43.11784, 131.922029],
      [43.117841, 131.922049],
      [43.117846, 131.922087],
      [43.117865, 131.92214],
      [43.117997, 131.922343],
      [43.118082, 131.922484],
      [43.118101, 131.922529],
      [43.118114, 131.922599],
      [43.118123, 131.922628],
      [43.118149, 131.922687],
      [43.118182, 131.922748],
      [43.118263, 131.92285],
      [43.118297, 131.922874],
      [43.118335, 131.92288],
      [43.118367, 131.9229],
      [43.1184, 131.922954],
      [43.118425, 131.923019],
      [43.118456, 131.923052],
      [43.118472, 131.923058],
      [43.11852, 131.923109],
      [43.118528, 131.923148],
      [43.118534, 131.923156],
      [43.118546, 131.923156],
    ],

    // line13
    [
      [43.118397, 131.921576],
      [43.118398, 131.921588],
      [43.118399, 131.921702],
      [43.118382, 131.921868],
      [43.118349, 131.921971],
      [43.118345, 131.922109],
      [43.11847, 131.922472],
      [43.118517, 131.922849],
      [43.118531, 131.923041],
      [43.118546, 131.923156],
      [43.118564, 131.923234],
      [43.118587, 131.923269],
      [43.118645, 131.923305],
      [43.118688, 131.92336],
      [43.118724, 131.923378],
    ],

    // line14
    [
      [43.118382, 131.921868],
      [43.11832, 131.921844],
    ],

    // line15
    [
      [43.118349, 131.921971],
      [43.11832, 131.921844],
      [43.118182, 131.921673],
      [43.118138, 131.921633],
      [43.118053, 131.92161],
      [43.117993, 131.921611],
      [43.11795, 131.921598],
      [43.117956, 131.92163],
      [43.117977, 131.921691],
      [43.117991, 131.921767],
      [43.117992, 131.92181],
      [43.117985, 131.921844],
      [43.117959, 131.921873],
      [43.117937, 131.921885],
      [43.117913, 131.921885],
      [43.117893, 131.921875],
    ],

    // line16
    [
      [43.118054, 131.921573],
      [43.118053, 131.92161],
      [43.118071, 131.921679],
      [43.118056, 131.921862],
      [43.118047, 131.921905],
      [43.118035, 131.921945],
      [43.117981, 131.922108],
      [43.117976, 131.922144],
      [43.117975, 131.922186],
      [43.117984, 131.922272],
      [43.117997, 131.922343],
      [43.118002, 131.922412],
      [43.118, 131.922457],
      [43.118005, 131.922505],
      [43.11799, 131.922535],
      [43.117953, 131.922587],
      [43.11794, 131.922603],
    ],

    // line17
    [
      [43.117953, 131.922587],
      [43.118023, 131.922664],
      [43.118051, 131.922614],
      [43.118055, 131.922604],
    ],

    // line18
    [
      [43.117856, 131.921952],
      [43.117831, 131.921945],
      [43.117813, 131.921934],
      [43.117794, 131.921955],
      [43.117771, 131.921973],
    ],

    // line19
    [
      [43.11784, 131.922029],
      [43.117815, 131.922004],
      [43.117771, 131.921973],
      [43.117766, 131.921971],
      [43.117731, 131.921965],
      [43.117695, 131.921939],
      [43.117606, 131.921893],
    ],

    // line20
    [
      [43.118114, 131.922599],
      [43.118093, 131.922585],
      [43.11808, 131.92258],
      [43.118067, 131.922587],
      [43.118055, 131.922604],
      [43.11799, 131.922535],
      [43.11796, 131.922508],
      [43.117937, 131.922493],
      [43.117916, 131.922499],
      [43.117911, 131.922561],
      [43.117923, 131.922586],
      [43.11794, 131.922603],
    ],
  ];

  paths.forEach((coords) => {
    const line = new ymaps.Polyline(
      coords,
      {},
      {
        strokeColor: "rgba(0,0,0,0.4)",
        strokeWidth: 4,
        strokeOpacity: 1,
      }
    );
    map.geoObjects.add(line);
  });

  const kafeCoords = [
    [43.118482, 131.922037],
    [43.118418, 131.922037],
    [43.118421, 131.921826],
    [43.118483, 131.921829],
  ];
  const kafePolygon = new ymaps.Polygon(
    [kafeCoords],
    {},
    {
      fillColor: "rgba(255,0,0,0.6)",
      strokeColor: "#FF0000",
      strokeWidth: 2,
    }
  );
  const lakeCoords = [
    [43.11836, 131.921635],
    [43.118251, 131.921661],
    [43.118252, 131.921689],
    [43.118292, 131.921737],
    [43.118334, 131.921767],
    [43.118354, 131.921748],
    [43.118363, 131.921642],
  ];
  const lakePolygon = new ymaps.Polygon(
    [lakeCoords],
    {},
    {
      fillColor: "rgba(0,191,255,0.6)",
      strokeColor: "#ffffff",
      strokeWidth: 0,
    }
  );
  map.geoObjects.add(kafePolygon);
  map.geoObjects.add(lakePolygon);

  const places = [
    {
      coords: [43.118498, 131.921068],
      name: "Центральный вход",
      iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
      img: "https://irecommend.ru/sites/default/files/imagecache/copyright1/user-images/780059/MKC8MtpNa6lublq39RrdA.jpg",
      desc: "Главный вход в парк.",
    },
    {
      coords: [43.118138, 131.921299],
      name: "Детская площадка",
      iconUrl: "https://cdn-icons-png.flaticon.com/512/248/248635.png",
      img: "https://avatars.mds.yandex.net/get-altay/5459048/2a0000017c83581717147f49babf826836f8/L_height",
      desc: "Песочницы и качели для детей.",
    },
    {
      coords: [43.11785, 131.921685],
      name: "Фудкорт",
      iconUrl: "https://cdn-icons-png.flaticon.com/512/17795/17795825.png",
      img: "https://static.vl.ru/catalog/1752117265283_big_vlru.jpg",
      desc: "Много вкусной еды.",
    },
    {
      coords: [43.118417, 131.921997],
      name: "Туалет",
      iconUrl: "https://cdn-icons-png.flaticon.com/512/75/75310.png",
      img: "https://danil-shiryaev.ru/public/uploads/travel/2023/vladivostok/img_4343.jpeg",
      desc: "Общественные туалеты.",
    },
    {
      coords: [43.118421, 131.921866],
      name: "Кофейня",
      iconUrl: "https://cdn-icons-png.flaticon.com/512/1223/1223231.png",
      img: "https://n1s1.hsmedia.ru/8c/46/03/8c460364e999190c313d38975fb7edb3/3402x2268_0xusE7flG1_6695509493297327961.jpg",
      desc: "Кофе и десерты.",
    },
  ];

  const placesList = document.getElementById("placesList");
  const infoFrame = document.getElementById("infoFrame");
  const menuList = document.getElementById("menuList");
  const infoTitle = document.getElementById("infoTitle");
  const infoImg = document.getElementById("infoImg");
  const infoDesc = document.getElementById("infoDesc");
  const backBtn = document.getElementById("backBtn");

  const offcanvasElement = document.getElementById("offcanvasSidebar");
  const offcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasElement);

  places.forEach((place) => {
    const placemark = new ymaps.Placemark(
      place.coords,
      {
        balloonContentHeader: place.name,
        balloonContentBody: `<img class="popup-img" src="${place.img}"><p>${place.desc}</p>`,
      },
      {
        iconLayout: "default#image",
        iconImageHref: place.iconUrl,
        iconImageSize: [32, 32],
        iconImageOffset: [-16, -32],
        balloonOffset: [0, -32],
        balloonAutoPan: true,
        hideIconOnBalloonOpen: false,
      }
    );
    map.geoObjects.add(placemark);

    const item = document.createElement("div");
    item.className = "place-item";
    item.innerHTML = `<img class="place-icon" src="${place.iconUrl}"> ${place.name}`;
    item.onclick = () => {
      map.setCenter(place.coords, 19, { duration: 500 });
      placemark.balloon.open();
      menuList.style.display = "none";
      infoFrame.style.display = "block";
      infoTitle.textContent = place.name;
      infoImg.src = place.img;
      infoDesc.textContent = place.desc;
      // offcanvas.hide();
    };
    placesList.appendChild(item);
  });

  backBtn.onclick = () => {
    infoFrame.style.display = "none";
    menuList.style.display = "block";
  };
}
